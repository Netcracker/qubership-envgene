# env_definition.yml structure

env_definition.yml used to define inventory for environment
## env_definition.yml file structure
```yaml
# mandatory | Structure that defines inventory of your environment
inventory:                    
    # mandatory 
    # name of the environment, e.g. dev01
    environmentName: string
    # mandatory 
    # name of the tenant for your environment
    tenantName: string
    # optional
    # name of the cloud for your environment
    cloudName: string
    # optional 
    # URL of the cluster from kube_config
    clusterUrl: string         
    # optional 
    # Environment description
    description: string        
    # optional
    # Environment owners
    owners: string                   
    config:
        # optional, default false
        # if true, during CMDB import credentials IDs, 
        # except defined with #"credscl" or "credsns" 
        # will be update using pattern:
        # <tenant-name>-<cloud-name>-<env-name>-<cred-id>
        updateCredIdsWithEnvName: boolean
        # optional, default false
        # if true, during CMDB import resource profile
        # override (RPO) names will be update with env 
        # name will be update using pattern:
        # <tenant-name>-<cloud-name>-<env-name>-<RPO-name>
        updateRPOverrideNameWithEnvName: boolean
# mandatory
# definition of template that will be used
envTemplate:
    # mandatory
    # name of the template, name should correspond to 
    # the name of template in your template artifact
    name: string
    # optional
    # array of file names in 'shared-credentials' folders that will override generated and defined for instance credentials
    sharedMasterCredentialFiles: array
    # optional
    # array of file names in 'shared-template-variables' folders that will be merged with additionalTemplateVariables
    sharedTemplateVariables: array
    # optional
    # additional variables that will be available
    # during template processing
    additionalTemplateVariables: hashmap
    # optional
    # envronment specific deployment parameters set, 
    # array items should contain file name (w/o extension)
    # to the file located in "parameters" dir
    envSpecificParamsets: hashmap
    # optional
    # envronment specific e2e parameters set, 
    # array items should contain file name (w/o extension)
    # to the file located in "parameters" dir
    envSpecificE2EParamsets: hashmap
    # optional
    # envronment specific technical parameters set, 
    # array items should contain file name (w/o extension)
    # to the file located in "parameters" dir
    envSpecificTechnicalParamsets: hashmap
    # optional
    # envronment specific resource profile overrides, 
    # array items should contain file name (w/o extension)
    # to the file located in "resource_profiles" dir
    envSpecificResourceProfiles: hashmap
    # mandatory
    # structure to define template artifact
    templateArtifact:
        # mandatory
        # registry name
        # should be listed in configuration/registry.yml
        registry: string
        # mandatory
        # repository name for zip artifact of template
        # should be listed in configuration/registry.yml
        repository: string
        # mandatory
        # repository name for storing Deployment Descriptor artifact of template
        # should be listed in configuration/registry.yml
        templateRepository: string
        # mandatory
        # definition of template artifact that will be 
        # used for environment generation
        artifact:
            group_id: string
            artifact_id: string
            version: string
    # following parameters are automatically generated during job and display that version of Deployment Descriptor artifact of template was used for last environment generation
    generatedVersions: hashmap
```
## inventory section parameters description
| Parameter | Description | Mandatory/Optional | Example | Comment |
| --------- | ----------- | ------------------ | ------- | ------- |
| environmentName | Name of your environment | mandatory | simplest-env | [Sample here](samples/environments/sample-cloud-name/simplest-env/Inventory/env_definition.yml) |
| tenantName | Name of CMDB tenant for your environment | mandatory | Applications | [Sample here](samples/environments/sample-cloud-name/simplest-env/Inventory/env_definition.yml) |
| cloudName | Name of CMDB cloud for your environment | optional | k8s_apps_11_env_1 | If parameter is not definied explicitly than value for cloud during rendering will be automatically generated by pattern ```<clusterName>_<environmentName>".replace('-', 'Â _')``` <br> [Sample here](samples/environments/sample-cloud-name/simplest-env/Inventory/env_definition.yml)|
| clusterUrl | URL of the cluster from kube_config | optional | ```https://api.k8s-apps11.managed.netcracker.cloud:6443``` | This field is needed only if cloud passport is not used. It is used to calculate cluster level fields in templated macros and to form the cluster endpoint information in the topology context of the effective-set. The URL is parsed to extract the protocol, hostname, and port to populate the `cluster.api_url`, `cluster.api_port`, `cluster.public_url`, and `cluster.protocol` variables in the topology context. The `public_url` is derived by removing the 'api.' prefix from the hostname. |
| description | Free text description for your cluster | optional | Any text describing your cluster ||
| owners | Free text for owners of the cluster | optional | Ivan Ivanov ||

## template section parameters description
TBD

## Samples
### Basic sample of env_definition.yaml with minimal set of fields

```yaml
inventory:
  environmentName: "simplest-env"
  tenantName: "Applications"
envTemplate:
  name: "simple"
  templateArtifact:
    registry: "artifactorycn"
    repository: "snapshotRepository"
    artifact:
      group_id: "com.netcracker.deploy.product"
      artifact_id: "prod.inmrnd.mano_devops_releaseengineering_sandboxtestenvironment_configuration-management_template-project"
      version: "release/master_20231024-080204"
```

### Full sample of env_definition.yaml
```yaml
inventory:
  environmentName: "override-env-name"
  tenantName: "CODETOPROD"
  cloudName: "ovverride_cloud_name"
  description: "Full sample"
  owners: "qubership team"
  config:
    updateRPOverrideNameWithEnvName: false
    updateCredIdsWithEnvName: true
envTemplate:
  name: "composite-prod"
  additionalTemplateVariables:
    ci:
      CI_PARAM_1: ci-param-val-1
      CI_PARAM_2: ci-param-val-2
    e2eParameters:
      E2E_PARAM_1: e2e-param-val-1
      E2E_PARAM_2: e2e-param-val-2
  sharedTemplateVariables:
  - prod-template-variables
  - sample-cloud-template-variables
  envSpecificParamsets:
    bss: ["env-specific-bss", "prod-shared"]
  envSpecificTechnicalParamsets:
    bss: ["env-specific-tech"]
  envSpecificE2EParamsets:
    cloud: ["cloud-level-params"]
  sharedMasterCredentialFiles:
  - prod-integration-creds
  templateArtifact:
    registry: "artifactorycn"
    repository: "snapshotRepository"
    artifact:
      group_id: "com.netcracker.deploy.product"
      artifact_id: "prod.inmrnd.mano_devops_releaseengineering_sandboxtestenvironment_configuration-management_template-project"
      version: "master_20231005-131627"
```
Link to git file [samples/environments/sample-cloud-name/composite-full/Inventory/env_definition.yml](samples/environments/sample-cloud-name/composite-full/Inventory/env_definition.yml). 
